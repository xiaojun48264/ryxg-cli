import{BuildAction as h}from"./build.action.mjs";import g from"ora";import v from"prompts";import d from"chalk";import{getManifest as B,isCliProject as P,compileProject as D,getUnpackagePath as b}from"../lib/utils/tools.mjs";import s from"node:path";import{createLauncher as C}from"../lib/launchers/index.mjs";import{DeviceLauncher as j}from"../lib/launchers/deviceLauncher.mjs";import{printLog as w}from"../lib/utils/logs.mjs";class x extends h{async handle(i,u){const n=i.find(a=>a.name==="platform")?.value,l=u.find(a=>a.name==="custom")?.value,p=u.find(a=>a.name==="path")?.value,f=g("\u83B7\u53D6\u8BBE\u5907\u5217\u8868...").start(),c=await C(n).getMobileList();f.stop(),c.length===0&&(console.log(d.red("\u2716")+" \u672A\u627E\u5230\u53EF\u7528\u8BBE\u5907"),process.exit(1));const m=await B(p),o={adbPath:"",androidBasePath:"",androidSimulatorPort:"26944",appName:m.name||"",appid:m.appid||"",compilePath:"",isCli:P(p),model:"",name:"",pagePath:"",pageQuery:"",platform:n,projectNatureId:"UniApp_Vue",projectPath:p,uuid:"",version:"",mobile:{},deviceLauncher:new j};if(n==="android"){const a=await v([{name:"udid",type:"select",message:"\u9009\u62E9\u8FD0\u884C\u8BBE\u5907",choices:c.map(r=>({title:r.name,value:r.udid}))}],{onCancel(){console.log(d.red("\u2716")+" \u64CD\u4F5C\u88AB\u53D6\u6D88"),process.exit(1)}}),t=c.find(r=>r.udid===a.udid);Object.assign(o,{name:t?.name,platform:t?.platform,uuid:t?.udid,version:t?.version,mobile:t})}E(o),await F(o,l),await D(o)||(console.log(d.red("\u2716")+" \u7F16\u8BD1\u5931\u8D25"),process.exit(1)),w("\u7F16\u8BD1\u6210\u529F","success"),await o.deviceLauncher.runDevice(o)}}function E(e){let i="unpackage";e.isCli&&(i=""),e.compilePath=s.resolve(e.projectPath,i,"dist","dev","app")}async function F(e,i){if(i){let u=b(e.isCli,e.projectPath);e.platform=="android"&&(e.androidBasePath=s.resolve(u,"debug","android_debug.apk"))}}export{x as RunAction};
